# 功能規格：每日行程瀏覽功能

**功能分支**: `001-daily-itinerary-viewer`
**建立日期**: 2025-11-27
**狀態**: 草稿
**輸入**: 使用者描述: "每日行程瀏覽功能 - 使用者可以查看每日行程卡片，包含景點、餐廳、交通資訊，並可一鍵導航"

## 使用者情境與測試 *（必填）*

### 使用者故事 1 - 查看每日行程總覽 (優先級: P1)

身為旅行者，我希望能夠快速查看某一天的所有行程安排，包含時間軸上的活動、餐廳和交通資訊，以便掌握當日行程節奏。

**優先級理由**: 這是應用程式的核心功能，沒有行程瀏覽功能，應用程式就無法提供任何價值。

**獨立測試方式**: 可透過選擇特定日期並確認顯示該日所有卡片來完整測試，交付「使用者可查看完整當日行程」的價值。

**驗收情境**:

1. **假設** 使用者已開啟應用程式，**當** 選擇「第3天」，**則** 顯示 2026-04-12 的所有行程卡片，依時間排序
2. **假設** 行程資料包含 10 張卡片，**當** 載入第3天行程，**則** 所有 10 張卡片都正確顯示在畫面上
3. **假設** 使用者在離線狀態，**當** 查看已快取的行程，**則** 仍能正常顯示所有卡片內容

---

### 使用者故事 2 - 辨識不同類型的行程卡片 (優先級: P1)

身為旅行者，我希望能夠一眼區分活動、餐廳和交通卡片，以便快速找到我需要的資訊。

**優先級理由**: 視覺區分是行程瀏覽的基本需求，直接影響使用體驗。

**獨立測試方式**: 可透過確認三種卡片類型各有明確的視覺區分（顏色、圖示）來測試，交付「資訊一目了然」的價值。

**驗收情境**:

1. **假設** 畫面上有活動卡片，**當** 使用者查看卡片，**則** 卡片以藍色系呈現並顯示活動圖示
2. **假設** 畫面上有餐廳卡片，**當** 使用者查看卡片，**則** 卡片以橘色系呈現並顯示餐廳圖示
3. **假設** 畫面上有交通卡片，**當** 使用者查看卡片，**則** 卡片以灰色系呈現並顯示交通圖示

---

### 使用者故事 3 - 一鍵導航至目的地 (優先級: P1)

身為旅行者，我希望能夠點擊卡片上的導航按鈕直接開啟 Google Maps，以便快速前往目的地。

**優先級理由**: 導航功能是旅遊應用的核心實用功能，大幅提升使用價值。

**獨立測試方式**: 可透過點擊任意卡片的導航按鈕，確認能正確開啟 Google Maps 並顯示路線來測試，交付「無縫導航體驗」的價值。

**驗收情境**:

1. **假設** 卡片包含導航 URL，**當** 使用者點擊導航按鈕，**則** 開啟 Google Maps 應用程式或網頁版並顯示路線
2. **假設** 卡片不含導航 URL，**當** 使用者查看卡片，**則** 不顯示導航按鈕
3. **假設** 使用者在 iPhone 上，**當** 點擊導航按鈕，**則** 優先嘗試開啟 Google Maps App，若未安裝則開啟網頁版

---

### 使用者故事 4 - 查看卡片詳細資訊 (優先級: P2)

身為旅行者，我希望能夠展開卡片查看更多細節，例如價格、注意事項、備用選項等，以便做出更好的決定。

**優先級理由**: 詳細資訊對行程規劃很重要，但可在基本瀏覽功能完成後再實作。

**獨立測試方式**: 可透過點擊卡片展開/收合，確認所有詳細資訊正確顯示來測試，交付「深入了解每個行程項目」的價值。

**驗收情境**:

1. **假設** 使用者查看餐廳卡片，**當** 點擊展開，**則** 顯示價格範圍、推薦菜色、素食選項、備用餐廳等資訊
2. **假設** 使用者查看交通卡片，**當** 點擊展開，**則** 顯示交通方式、車程時間、票價、路線說明等資訊
3. **假設** 使用者查看活動卡片，**當** 點擊展開，**則** 顯示待辦事項、小提示、營業時間等資訊

---

### 使用者故事 5 - 查看當日路線總覽 (優先級: P2)

身為旅行者，我希望能夠查看當天的整體路線摘要，以便理解當日的移動動線。

**優先級理由**: 路線總覽幫助使用者掌握全局，但不影響單一行程項目的使用。

**獨立測試方式**: 可透過查看每日頁面頂部或底部的路線摘要區塊來測試，交付「快速掌握當日動線」的價值。

**驗收情境**:

1. **假設** 當日行程有路線摘要資料，**當** 使用者查看當日行程，**則** 顯示「成田機場 → 上野站 → 飯店」等路線描述
2. **假設** 路線摘要包含地圖連結，**當** 使用者點擊，**則** 開啟 Google Maps 顯示完整路線

---

### 使用者故事 6 - 切換不同天數的行程 (優先級: P2)

身為旅行者，我希望能夠方便地切換查看不同天數的行程，以便快速比較或規劃。

**優先級理由**: 多日行程瀏覽是完整體驗的一部分，但單日瀏覽已能提供基本價值。

**獨立測試方式**: 可透過左右滑動或點擊日期選擇器切換天數來測試，交付「輕鬆瀏覽多日行程」的價值。

**驗收情境**:

1. **假設** 使用者正在查看第1天行程，**當** 向左滑動或點擊「第2天」，**則** 畫面切換顯示第2天行程
2. **假設** 使用者正在查看第6天行程，**當** 嘗試切換到下一天，**則** 無法繼續滑動或按鈕呈現禁用狀態

---

### 邊界情況

- 當行程資料尚未載入完成時，顯示載入中狀態（skeleton loading）
- 當行程資料載入失敗時，顯示錯誤訊息並提供重試選項
- 當某張卡片缺少必要欄位（如 title、time）時，仍顯示該卡片但以預設值填充
- 當使用者快速切換天數時，確保只載入最終選擇的那天資料（防止競態條件）
- 當卡片內容過長時，展開狀態需支援捲動

## 需求 *（必填）*

### 功能需求

- **FR-001**: 系統必須能從本地 IndexedDB 讀取並顯示每日行程資料
- **FR-002**: 系統必須依照時間順序顯示當日所有行程卡片
- **FR-003**: 系統必須以視覺差異區分三種卡片類型：activity（藍色）、restaurant（橘色）、transport（灰色）
- **FR-004**: 系統必須在卡片上顯示基本資訊：時間、標題、副標題、地點名稱
- **FR-005**: 系統必須提供導航按鈕，點擊後開啟 Google Maps（若 navigationUrl 存在）
- **FR-006**: 系統必須支援展開/收合卡片以查看詳細資訊
- **FR-007**: 系統必須顯示卡片上的標籤（tags），如「🐼 必看熊貓」、「🍜 名店蕎麥麵」
- **FR-008**: 系統必須支援在不同天數之間切換瀏覽
- **FR-009**: 系統必須顯示當日路線摘要（若 routeSummary 存在）
- **FR-010**: 系統必須在離線狀態下仍能顯示已快取的行程資料

### 關鍵實體 *（若功能涉及資料則需填寫）*

- **Trip**: 代表一趟旅行，包含旅行名稱、日期範圍、目的地列表、每日行程參照
- **DayPlan**: 代表單日行程，包含日期、主題、地點、卡片列表、路線摘要
- **Card**: 代表單一行程項目，分為三種類型：
  - **ActivityCard**: 活動卡片，包含時間、標題、地點、待辦事項、小提示
  - **RestaurantCard**: 餐廳卡片，包含時間、餐廳名稱、料理類型、價格範圍、素食選項、備用餐廳
  - **TransportCard**: 交通卡片，包含時間、起訖站、交通方式、車程時間、票價、路線說明
- **Location**: 代表地點資訊，包含名稱、地址、Google Maps 導航 URL

## 成功標準 *（必填）*

### 可衡量成果

- **SC-001**: 使用者可在 2 秒內載入並顯示任一天的完整行程（首次載入）
- **SC-002**: 使用者可在 0.5 秒內切換到另一天的行程（已快取資料）
- **SC-003**: 卡片類型的視覺區分度達到 95% 正確辨識率（使用者測試）
- **SC-004**: 導航按鈕點擊後，Google Maps 在 3 秒內開啟並顯示正確目的地
- **SC-005**: 離線狀態下，已瀏覽過的行程資料 100% 可再次存取
- **SC-006**: 頁面在 iPhone SE（最小支援螢幕）上完整顯示，無水平捲動
