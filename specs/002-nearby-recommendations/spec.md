# 功能規格：附近餐廳與景點推薦

**功能分支**: `002-nearby-recommendations`
**建立日期**: 2025-11-28
**狀態**: 草稿
**輸入**: 使用者描述: "新增餐廳和景點推薦，到達某地點可推薦附近餐廳和景點，整合地圖，使用 Foursquare API"

## 使用者情境與測試 *（必填）*

### 使用者故事 1 - 從行程卡片查看附近推薦 (優先級: P1)

身為旅行者，當我到達行程中的某個景點（如上野公園）時，我希望能夠點擊卡片上的「附近推薦」按鈕，查看該地點附近的餐廳和景點，以便發現更多值得探索的地方。

**優先級理由**: 這是功能的核心入口，沒有這個按鈕使用者就無法觸發推薦功能。

**獨立測試方式**: 可透過點擊任意行程卡片的「附近推薦」按鈕，確認顯示推薦清單來完整測試，交付「發現附近好去處」的價值。

**驗收情境**:

1. **假設** 使用者正在查看上野公園的行程卡片，**當** 點擊「附近推薦」按鈕，**則** 顯示以上野公園為中心的附近推薦清單
2. **假設** 行程卡片包含地點座標，**當** 點擊「附近推薦」按鈕，**則** 使用該座標搜尋附近地點
3. **假設** 行程卡片僅包含地點名稱（無座標），**當** 點擊「附近推薦」按鈕，**則** 先將地點名稱轉換為座標後再搜尋

---

### 使用者故事 2 - 查看推薦清單 (優先級: P1)

身為旅行者，我希望看到附近推薦的清單，包含名稱、類型、距離和評分等基本資訊，以便快速瀏覽並決定要去哪裡。

**優先級理由**: 清單是呈現推薦結果的基本方式，是使用者瀏覽推薦的主要介面。

**獨立測試方式**: 可透過檢視推薦清單的內容完整性來測試，交付「快速瀏覽附近選項」的價值。

**驗收情境**:

1. **假設** 系統已取得附近推薦資料，**當** 顯示推薦清單，**則** 每個項目包含名稱、類型圖示、距離（公尺或公里）、評分（若有）
2. **假設** 附近有 20 個推薦地點，**當** 顯示清單，**則** 預設顯示最近的 10 個，可載入更多
3. **假設** 推薦項目有照片，**當** 顯示清單項目，**則** 顯示縮圖照片

---

### 使用者故事 3 - 篩選推薦類別 (優先級: P1)

身為旅行者，我希望能夠篩選只看餐廳或只看景點，以便專注於我當下的需求。

**優先級理由**: 篩選是提升瀏覽效率的關鍵功能，直接影響使用體驗。

**獨立測試方式**: 可透過切換篩選選項並確認清單正確過濾來測試，交付「精準找到需要的類型」的價值。

**驗收情境**:

1. **假設** 使用者查看推薦清單，**當** 點擊「餐廳」篩選，**則** 清單只顯示餐廳類型的推薦
2. **假設** 使用者查看推薦清單，**當** 點擊「景點」篩選，**則** 清單只顯示景點類型的推薦
3. **假設** 使用者已套用篩選，**當** 點擊「全部」，**則** 清單顯示所有類型的推薦

---

### 使用者故事 4 - 在地圖上查看推薦位置 (優先級: P2)

身為旅行者，我希望在嵌入式地圖上看到所有推薦地點的位置標記，以便了解它們的相對位置和距離。

**優先級理由**: 地圖視覺化幫助使用者理解空間關係，但清單瀏覽已能提供基本價值。

**獨立測試方式**: 可透過查看地圖並確認標記位置正確來測試，交付「直覺理解地理位置」的價值。

**驗收情境**:

1. **假設** 使用者開啟推薦頁面，**當** 切換到地圖檢視，**則** 顯示以搜尋地點為中心的地圖，並標記所有推薦地點
2. **假設** 地圖上有多個標記，**當** 使用者點擊某個標記，**則** 顯示該地點的簡要資訊卡片
3. **假設** 使用者套用了類別篩選，**當** 查看地圖，**則** 只顯示符合篩選條件的標記

---

### 使用者故事 5 - 查看推薦詳情 (優先級: P2)

身為旅行者，我希望點擊推薦項目後能看到更詳細的資訊，包含營業時間、價格範圍、照片等，以便做出是否前往的決定。

**優先級理由**: 詳細資訊幫助使用者做決策，但基本清單已能提供初步判斷。

**獨立測試方式**: 可透過點擊推薦項目並確認顯示完整詳情來測試，交付「深入了解目的地」的價值。

**驗收情境**:

1. **假設** 使用者點擊某餐廳推薦，**當** 顯示詳情，**則** 包含餐廳名稱、評分、價格範圍、營業時間、地址、照片（若有）
2. **假設** 使用者點擊某景點推薦，**當** 顯示詳情，**則** 包含景點名稱、類型、簡介、開放時間、地址、照片（若有）
3. **假設** 詳情頁面已開啟，**當** 使用者點擊「導航」按鈕，**則** 開啟 Google Maps 並顯示路線

---

### 使用者故事 6 - 導航至推薦地點 (優先級: P2)

身為旅行者，我希望能夠直接從推薦清單或詳情頁面開啟導航，以便快速前往目的地。

**優先級理由**: 導航是將推薦轉化為行動的關鍵功能。

**獨立測試方式**: 可透過點擊導航按鈕並確認開啟 Google Maps 來測試，交付「無縫前往目的地」的價值。

**驗收情境**:

1. **假設** 使用者在推薦清單中，**當** 點擊某項目的導航圖示，**則** 開啟 Google Maps 並顯示從目前位置到該地點的路線
2. **假設** 使用者在 iPhone 上，**當** 點擊導航，**則** 優先嘗試開啟 Google Maps App，若未安裝則開啟網頁版

---

### 使用者故事 7 - 離線查看已搜尋的推薦 (優先級: P3)

身為旅行者，我希望在離線狀態下仍能查看之前搜尋過的推薦結果，以便在網路不穩定時仍能參考。

**優先級理由**: 離線功能符合專案憲法的「離線優先」原則，但需要先完成線上功能。

**獨立測試方式**: 可透過在離線狀態下查看已快取的推薦來測試，交付「無網路也能使用」的價值。

**驗收情境**:

1. **假設** 使用者之前搜尋過上野公園附近推薦，**當** 在離線狀態下再次查看，**則** 顯示快取的推薦結果
2. **假設** 使用者在離線狀態，**當** 嘗試搜尋新地點的推薦，**則** 顯示「需要網路連線」的提示

---

### 邊界情況

- 當搜尋結果為空時，顯示「附近沒有找到推薦地點」的友善提示
- 當網路請求失敗時，顯示錯誤訊息並提供重試選項
- 當地點名稱無法轉換為座標時，顯示「無法定位此地點」的提示
- 當推薦資料正在載入時，顯示載入中狀態（skeleton loading）
- 當使用者快速切換篩選條件時，確保只顯示最終篩選結果
- 當地圖載入失敗時，仍可使用清單檢視功能

## 需求 *（必填）*

### 功能需求

- **FR-001**: 系統必須在每個行程卡片上顯示「附近推薦」按鈕
- **FR-002**: 系統必須能根據地點座標搜尋附近的餐廳和景點
- **FR-003**: 系統必須能將地點名稱轉換為座標（若卡片未提供座標）
- **FR-004**: 系統必須以清單形式顯示推薦結果，包含名稱、類型、距離、評分
- **FR-005**: 系統必須支援依類別（全部/餐廳/景點）篩選推薦結果
- **FR-006**: 系統必須在嵌入式地圖上顯示推薦地點的位置標記
- **FR-007**: 系統必須支援點擊地圖標記顯示簡要資訊
- **FR-008**: 系統必須提供推薦詳情頁面，顯示完整資訊
- **FR-009**: 系統必須提供導航功能，點擊後開啟 Google Maps
- **FR-010**: 系統必須快取搜尋結果以支援離線瀏覽
- **FR-011**: 系統必須使用抽象化的資料層，便於未來切換資料來源

### 關鍵實體

- **RecommendedPlace**: 代表一個推薦地點，包含：
  - 唯一識別碼
  - 名稱
  - 類型（餐廳/景點）
  - 座標（緯度、經度）
  - 距離（相對於搜尋中心點）
  - 評分（1-5 分，可選）
  - 價格範圍（$-$$$$，可選，餐廳適用）
  - 地址
  - 營業時間（可選）
  - 照片 URL 列表（可選）
  - 簡介（可選）

- **SearchCenter**: 代表搜尋的中心點，包含：
  - 地點名稱
  - 座標（緯度、經度）
  - 搜尋半徑

- **RecommendationCache**: 代表快取的搜尋結果，包含：
  - 搜尋中心點
  - 推薦地點列表
  - 快取時間
  - 過期時間

## 成功標準 *（必填）*

### 可衡量成果

- **SC-001**: 使用者從點擊「附近推薦」按鈕到看到推薦清單，時間不超過 3 秒
- **SC-002**: 地圖載入並顯示所有標記的時間不超過 2 秒
- **SC-003**: 點擊地圖標記後，資訊卡片在 0.5 秒內顯示
- **SC-004**: 推薦清單支援顯示至少 50 個地點（可捲動載入）
- **SC-005**: 已搜尋過的推薦在離線狀態下 100% 可再次查看（快取 7 天內有效）
- **SC-006**: 篩選切換後清單在 0.3 秒內更新
- **SC-007**: 功能在 iPhone SE（最小支援螢幕）上完整顯示，無水平捲動

## 假設與限制

### 假設

- 使用者的行程卡片至少包含地點名稱或座標資訊
- Foursquare API 免費方案足以支援開發和初期使用
- 使用者可接受推薦資料可能有延遲（最多 24 小時）
- 地圖嵌入使用開源方案（如 Leaflet + OpenStreetMap）以避免額外費用

### 限制

- 初版不支援即時定位（使用行程卡片的地點資訊）
- 推薦搜尋半徑固定為 1 公里（未來可調整）
- 資料來源為 Foursquare API，架構設計支援未來擴展
